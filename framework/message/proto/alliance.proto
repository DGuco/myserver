syntax = "proto2";
package slg.protocol;
option java_package="com.bonusstudio.slg.protocol";
option java_outer_classname="AllianceProto";
import "common.proto";

//联盟概要信息
message AllianceSummaryDTO{
    required int32 id = 1;              // id
    required string name = 2;           // 名称
    required int32 honor = 3;           // 荣誉
    required int32 flag = 4;            // 旗帜
    required string leaderName = 5;     // 盟主名字
    required int32 memberLimit = 6;     // 成员人数上限    
    required int32 currentMember = 7;   // 当前成员数
}

//投票结构
message AllianceTechVoteDTO {
    required int32 techType = 1;     //科技类型
    required int32 voteNum = 2;     //科技投票数
}

//推荐玩家
message RecommendDTO {
    required int64 playerId = 1;//玩家uid
    required string icon = 2;//玩家头像
    required int32 battle = 3;//玩家战力
    required bool isInvited = 4;//是否已邀请
    required string playerName = 5;//玩家昵称
}

//联盟邀请
message AllianceInviteDTO
{
	required int32 allianceId = 1; //联盟ID
	required string allianceName = 2;//联盟名称
	required int32 icon = 3;//联盟图标
	required int32 current = 4;//联盟当前人数
	required int32 limit = 5;//联盟人数上限
	required int32 honor = 6;//联盟荣誉
	required int64 leaderId = 7;//盟主uid
	required string leaderName = 8;//盟主昵称
	required int32 inviteTime = 9;//邀请时间（时间戳）
}

message AllianceShopItemDTO{
    required int32 id = 1;          //shop表id
    required int32 buyTimes = 2;    //已购买次数
}

message ContributeDTO {
    required int32      level   = 1;
    required bool       is_open = 2;
    required int32      type     = 3;//1 金币 2钻石
}

message AllianceContributeInfoDTO {
    repeated ContributeDTO contributes = 1; 
    required int32 coolDownTime = 2;              //冷却累计时间
    required int32 coolStartTime = 3;             //冷却开始时间
    required bool  isJoinCd  = 4;                 //是否是加入联盟的cd 
}

message AllianceTechDTO {
    required int32 type = 1;        //科技类型
    required int32 level = 2;       //科技等级 
}

message AllianceTechUpgradeDTO {
    required int32 type = 1;        //科技类型
    required int32 endTime = 2;     //升级结束时间
}

//type
// 1 取代盟主
// 2 申请加入联盟
// 3 加入联盟
// 4 退出联盟
// 5 盟友攻打别人
// 6 盟友被攻击
// 7 联盟科技开始升级
// 8 同意入盟
// 9 拒绝入盟
// 10 科技升级完成
// 11 创建联盟
// 12 设置职位
// 13 转让盟主
// 14 踢出成员
message AllianceNewsDTO{
    required int32 id = 1;        //动态id
    required int32 type = 2;        //动态类型
    optional int64 targetId = 3;    // 玩家id      
    optional string applyMsg = 4;
    optional string playerName1 = 5;     
    optional string playerName2 = 6;    
    optional PositionDTO position = 7;  //敌方坐标
    optional int32 time = 8;
    optional bool friendIsWin = 9;      //盟友是否胜利
    optional string enAlliShortName = 10;//敌方联盟缩写
    optional int32 param1 = 11;//参数1（荣誉值／老职位）
    optional int32 param2 = 12;//参数2（等级／新职位）
}

message AllianceHelpDTO{
    required int32 timerId = 1;         // 帮助timerId
    required int64 playerId = 2;       // 玩家id
    required string playerName = 3;    // 玩家名称
    required int32 targetId = 4;       // 建筑id或者技能id
    required int32 helpType = 5;       // 帮助type: 1建筑 2科技
    required int32 helpTimes = 6;      // 帮助次数
    required int32 targetLevel = 7;      // 帮助目标等级
    required int32 maxTimes = 8;       //申请方最大可接受帮助次数
    required string playerIcon = 9;       //发起者icon
    required int32 helpId = 10;         // 帮助Id
}

//联盟成员信息
message AllianceMemberDTO {
    required int64 playerId = 1;         // 成员ID
    required string name = 2;           // 成员名称
    required int32 power = 3;           // 战力
    required int32 historyDon = 4;      //历史捐献
    required int32 dayDon     = 5;      //每日捐献
    required int32 weekDon  = 6;        //本周捐
    required bool isOnline = 7;    // 是否在线
    required string icon = 8;     // 头像
    required int32 position = 9;     // 职位 1 盟主 2 副盟主 3 普通成员
    required PositionDTO pos = 10;//城堡坐标
    required int32 lastLoginTime = 11; //上次登录时间  
    required int32 vipLevel = 12;
    required bool activated = 13;
}

//联盟基本信息
message AllianceDTO{
    required int32 id = 1;            // id
    required string name = 2;          // 名称
    required string shortName = 3;    // 缩写
    required int32 honor = 4;           // 荣誉
    required int32 flag = 5;            // 旗帜
    required string declaration = 6;     // 宣言
    required bool isPublic = 7; // 是否公开招募
    required int32 joinPower = 8;
    required string language = 9;        // 语言
    repeated AllianceMemberDTO members = 10;    // 成员列表
    required bool leaderAbsence = 11; //盟主7天没在线
    repeated AllianceNewsDTO msgs = 12; //联盟动态
    required int32 memberLimit = 13;    // 成员人数上限    
}

/// -------------------COMMAND----------------
enum AllianceCommandId {
    ALLIANCE_CRATE_ALLIANCE          = 1501;               //创建联盟
    ALLIANCE_QUERY_ALLIANCE          = 1502;               //查询联盟信息
    ALLIANCE_JOIN_ALLIANCE           = 1503;               //加入联盟
    ALLIANCE_SET_POSITION            = 1504;               //设置成员职位
    ALLIANCE_KICK_MEMBER             = 1505;               //剔除成员
    ALLIANCE_EXITS_MEMBER            = 1506;               //退出成员
    ALLIANCE_REPLACE_LEADER          = 1507;               //取代盟主 
    ALLIANCE_SET_ALLIANCE            = 1508;               //设置联盟
    ALLIANCE_APPLY_ALLIANCE          = 1509;               //审批加入请求
    ALLIANCE_GET_ALLIANCELIST        = 1510;               //拉取联盟列表
    ALLIANCE_CHECK_ALLIANCNAME       = 1511;               //检测联盟名字是否可用
    ALLIANCE_SEND_HELP               = 1512;               //发起联盟帮助
    ALLIANCE_HELP_MEMBER             = 1513;               //帮助联盟成员
    ALLIANCE_GET_HELP_LIST           = 1514;               //获取联盟帮助列表
    ALLIANCE_MY_ALLIANCE_INFO        = 1515;               //获取我的联盟信息
    ALLIANCE_TECH_VOTE               = 1516;               //联盟科技投票
    ALLIANCE_TECH_UPGRADE            = 1517;               //联盟科技升级
    ALLIANCE_CONTRIBUTE_INFO         = 1518;               //捐献信息
    ALLIANCE_CONTRIBUTE              = 1519;               //联盟捐献
    ALLIANCE_CONTRIBUTE_GIFT         = 1520;               //领取联盟捐献礼包
    ALLIANCE_CONTRIBUTE_CD_CLEAR     = 1521;               //清楚联盟捐献cd
    ALLIANCE_SHOP_INFO               = 1522;               //联盟商店信息
    ALLIANCE_SHOP_BUY                = 1523;               //联盟商店购买
    ALLIANCE_INVITE_JOIN             = 1524;               //邀请入盟
    ALLIANCE_DEAL_INVITE             = 1525;               //处理入盟邀请
    ALLIANCE_FRESH_RECOMMEND         = 1526;               //刷新推荐列表
    ALLIANCE_GET_RECOMMEND           = 1527;               //获取推荐列表
    ALLIANCE_QUICK_JOIN              = 1528;               //快速加入联盟
    ALLIANCE_QUERY_INVITER           = 1529;               //查找邀请玩家
    ALLIANCE_MEMBER_LIST             = 1530;               //联盟成员列表请求
    ALLIANCE_TRANSFER_LEADER         = 1531;               //转让盟主
    ALLIANCE_NEED_ALLIANCE_DATA      = 1532;               //是否需要联盟数据
    ALLIANCE_SUMMARY_INFO            = 1533;               //联盟概要信息  
}

message CreateAllianceRequest{
    required string name = 1;            // 名称
    required string declaration = 2;     // 宣言
}

message CreateAllianceResponse{
    required AllianceDTO alliance = 1;            // 联盟信息
}

message QueryAllianceRequest{
    optional int32 allianceId = 1;            // 联盟ID
    optional string allianceName = 2;            // 联盟名称
}

message QueryAllianceResponse{
    optional AllianceDTO alliance = 1;            // 联盟信息
}

message MyAllianceInfoRequest{
}

message MyAllianceInfoResponse{
    optional AllianceDTO alliance = 1;            // 联盟信息
}

message JoinAllianceRequest{
    required int32 allianceId = 1;           // 联盟id
    optional string applyMsg = 2; //申请信息
}

message JoinAllianceResponse{
    optional AllianceDTO alliance = 1;            // 联盟信息
}

message SetPositionRequest{
    required int64 playerId = 1;//玩家id
    required int32 position = 2;// 职位 1 盟主 2 副盟主 3 普通成员
}

message SetPositionResponse{
    required int64 playerId = 1;//玩家id
    required int32 position = 2;// 职位 1 盟主 2 副盟主 3 普通成员 
}

message KickOutAllianceRequest
{
    required int64 playerId = 1;//被踢玩家id
}

message ExitsAllianceRequest{
}

message ExitsAllianceResponse{
    required int64 playerId = 1;//玩家id
}

//转让盟主
message TransferLeaderRequest{
    required int64 playerId = 1;//盟主id
}

message TransferLeaderResponse{
    required int64 playerId = 1;//盟主id
}

message AllianceSettingRequest{
    optional string allianceName = 1;        // 联盟名称
    optional int32 flag = 2;          // 旗帜
    optional string declaration = 3;   // 宣言
    optional bool isPublic = 4; // 是否公开招募
    optional int32 joinPower = 5;    // 招募所需战斗力
    optional string language = 6;      // 语言
    optional string shortName = 7; //联盟缩写
}

message AllianceSettingResponse{
    optional string allianceName = 1;        // 联盟名称
    optional int32 flag = 2;          // 旗帜
    optional string declaration = 3;   // 宣言
    optional bool isPublic = 4; // 是否公开招募
    optional int32 joinPower = 5;    // 招募所需战斗力
    optional string language = 6;      // 语言
    optional string shortName = 7; //联盟缩写
}

message AllianceApplyRequest{
    required bool isAgree = 1; // 同意True，拒绝False
    required int64 playerId = 2; // 玩家ID
}

message AllianceApplyesponse{
    required bool isAgree = 1; // 同意True，拒绝False
}

message AllianceListRequest {
}

message AllianceListResponse {
    repeated AllianceSummaryDTO allianceList = 1; //联盟列表
}


message CheckAllianceNameRequest {
    required string name = 1;      // 名字
}

message CheckAllianceNameResponse {
    required bool isAvailable = 1; //是否可用
}

message SendAllianceHelpRequest {
    required int32 timerId = 1; //  建筑或者科技timer ID
    required int32 helpType = 2; // 帮助type: 1建筑 2科技 3技能
}

message HelpMemberRequest{
    required int32 helpId = 1; // 帮助信息ID(id = 0 帮助所有)
}

message HelpMemberResponse{
    required int32 helpId = 1; // 帮助信息ID(id = 0 帮助所有)
}


message AllianceHelpListRequest{
}

message AllianceHelpListResponse{
    repeated AllianceHelpDTO helpList = 1;
}

//联盟科技投票
message AllianceVoteRequest{
	required int32 techType = 1;	//	投票科技的类型
}

message AllianceVoteResponse{
    required int32 techType = 1;	//	投票科技的类型
}

//联盟科技升级
message AllianceTechUpgradeRequest{
	required int32 techType = 1;	//	升级科技的类型
}

message AllianceTechUpgradeResponse{
    required int32 techType = 1;	//	升级科技的类型
}

//联盟捐献信息
message ContributeInfoRequest{
}

message ContributeInfoResponse{
    required AllianceContributeInfoDTO donationInfo = 1;
    required int32 canReceiveTimes = 2;             //今日可领取次数
}

// //联盟科技信息
// message AllianceTechInfoRequest{
// }

// message AllianceTechInfoResponse{
//     repeated AllianceTechDTO techs = 1;
//     optional AllianceTechUpgradeDTO upgradeInfo = 2;
// }

//捐献
message ContributeRequest {
    required int32  level   = 1;//捐献等级
}

//领取联盟礼包
message DrawAllianceGiftRequest {
}

//领取联盟礼包
message DrawAllianceGiftResponse {
    repeated ItemDTO items = 1;                   //道具奖励
    repeated PropertyDTO propertys = 2;             //资源奖励
}

//花钻清除cd
message ClearContributedCdRequest {
}

message ClearContributedCdResponse {
    required int32 canContributeTime = 1;             //下次可捐献时间
}

//联盟商店信息
message AllianceShopInfoRequest{
}

message AllianceShopInfoResponse
{
    repeated AllianceShopItemDTO items = 1;
}

//联盟商店购买
message AllianceShopBuyRequest{
	required int32 id = 1;          //shop id
	required int32 num = 2;
}

message AllianceShopBuyResponse{
	required int32 id = 1;          //shop id
	required int32 num = 2;
    required int32 itemId = 3;          //item id
}

//邀请入盟
message InviteJoinAllianceRequest {
    required int64 playerId = 1;
}

message InviteJoinAllianceResponse {
    required int64 playerId = 1;
}

//处理邀请
message DealInviteRequest{
    required bool isAgree = 1; // 同意True，拒绝False
    required int32 allianceId = 2; // 联盟ID
}

message DealInviteResponse{
    required bool isAgree = 1; // 同意True，拒绝False
}

//刷新推荐列表
message FreshRecommendRequest{
}

//刷新推荐列表
message FreshRecommendResponse{
    repeated RecommendDTO recommendList = 1;  //推荐列表
    required int32 nextTime = 2; // 下次可刷新的实时间戳
}

//获取推荐列表
message GetRecommendRequest{
}

//获取推荐列表
message GetRecommendResponse{
    repeated RecommendDTO recommendList = 1;  //推荐列表
    required int32 nextTime = 2; // 下次可刷新的实时间戳
}

message QuickJoinRequest{
}

//查找邀请玩家
message QueryInviterRequest{
    required string playerName = 1; //查找玩家名称
}

message QueryInviterResponse{
    optional RecommendDTO player = 1;            // 联盟信息
}

//联盟成员列表请求
message AllianceMemberRequest{

}

message AllianceMemberResponse{
    repeated AllianceMemberDTO memberList = 1;
}

//客户端是否关注联盟成员数据
message NeedAllianceDataRequest{
    required bool isNeed = 1; //true:关注 false:不关注
}

//联盟概要信息
message AllianceSummaryRequest{
    required string name = 1;
}
message AllianceSummaryResponse{
    optional AllianceSummaryDTO summaryInfo = 1;
}

///  ----------------PUSH MESSAGES------------
enum AlliancePushId {
    ALLIANCE_MEMBER_CHANGE_PUSH = 51501;        //成员信息变化推送
    ALLIANCE_MEMBER_EXIT_PUSH   = 51502;        //成员退出推送
    ALLIANCE_MY_ALLIANCE_PUSH   = 51503;        //我的联盟信息推送
    ALLIANCE_HELP_CHANGE_PUSH   = 51504;        //联盟帮助变化
    ALLIANCE_HELP_REMOVE_PUSH   = 51505;        //联盟帮助删除
    ALLIANCE_NEWS_PUSH          = 51506;        //联盟消息推送
    ALLIANCE_TECH_PUSH          = 51507;        //联盟科技变化推送
    ALLIANCE_TECH_UPGRADE_PUSH  = 51508;        //联盟科技升级信息变化推送
    ALLIANCE_CONTRIBUTE_PUSH    = 51509;        //联盟捐献信息推送
    ALLIANCE_WELFARE_PUSH       = 51510;        //联盟福利信息推送
    ALLIANCE_NEWS_REMOVE_PUSH   = 51511;        //联盟消息删除推送
    ALLIANCE_INVITE_PUSH        = 51512;        //联盟邀请推送
    ALLIANCE_SENDHELP_PUSH      = 51513;        //已经发送过联盟帮助的timer id
    ALLIANCE_SCORE_PUSH         = 51514;        //联盟积分推送 
    ALLIANCE_MY_VOTE_PUSH       = 51515;        //我的科技投票信息
    ALLIANCE_VOTE_PUSH          = 51516;        //联盟科技投票信息
    ALLIANCE_CHANGE_PUSH        = 51517;        //联盟信息变化推送
    ALLIANCE_JOIN_SUCCEED       = 51518;        //加入联盟成功推送   
}

message MemberChangePush{
    repeated AllianceMemberDTO members = 1;           //成员信息
}

message MemberExitPush{
    required int64 playerId = 1;           //成员ID
}

message MyAllianceInfoPush{
    optional int32 id = 1;            // id
    optional string name = 2;          // 名称
    optional string shortName = 3;    // 缩写
    optional int32 flag = 4;            // 旗帜
    optional int32 position =5;         //职位
}

message HelpChangePush{
    repeated AllianceHelpDTO help = 1;
}

message HelpRemovePush{
    required int32 helpId = 1;
}

message AllianceNewsPush{
    required AllianceNewsDTO news = 1;
}

message AllianceTechPush{
    repeated AllianceTechDTO techs = 1;
}

message AllianceTechUpgradePush {
    required AllianceTechUpgradeDTO upgrade = 1;
}

message AllianceDonationPush {
    required AllianceContributeInfoDTO info = 1;
}

message AllianceWelfarePush {
    required int32 canReceiveTimes = 1;             //今日可领取次数
}

message AllianceNewsRemovePush {
    required int32 newsId = 1;
}

message AllianceInvitePush {
    repeated AllianceInviteDTO inviteList = 1;
}

message HasSendHelpTimesPush {
    repeated int32 timerIds = 1;
}

message AllianceScorePush {
    required int32 score  = 1;         //联盟积分（当前值）  
}

message MyVotePush {
    required int32 voteType  = 1;         //我的科技投票类型
}

message AllianceVoteInfoPush {
    repeated AllianceTechVoteDTO votes = 1; //投票信息
    optional bool isClear              = 2; //是否清空
}

message AllianceChangePush{
    optional string allianceName = 1;        // 联盟名称
    optional int32 flag = 2;          // 旗帜
    optional string declaration = 3;   // 宣言
    optional bool isPublic = 4; // 是否公开招募
    optional int32 joinPower = 5;    // 招募所需战斗力
    optional string language = 6;      // 语言
    optional string shortName = 7; //联盟缩写
    optional int32 honor = 8;      //联盟荣誉
}
